<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Madhuban Murli Audio Library</title>

<style>
html { scroll-behavior:smooth; }
body { font-family:Arial; margin:10px; background:#f5f5f5; color:#111; }
h1{text-align:center}
.year{background:#fff;padding:10px;margin-bottom:20px;border-radius:6px}
.months{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
@media(max-width:900px){.months{grid-template-columns:1fr}}
.month{background:#fafafa;padding:8px;border-radius:6px}
table{width:100%;border-collapse:collapse;font-size:11px}
th,td{text-align:center;padding:3px}
.day-btn{width:100%;padding:4px;border-radius:4px;background:#e7f3ff;border:1px solid #ccc;cursor:pointer}
.day-btn.selected{background:#2563eb;color:#fff;font-weight:bold}
#player{max-width:600px;margin:20px auto;padding:10px;background:#fff;border-radius:6px;text-align:center}
audio{width:100%}
</style>
</head>

<body id="top">

<h1>Madhuban Murli Audio Library</h1>

<div id="calendar"></div>

<div id="player">
  <p id="selected-date">Click any valid date to play its Murli.</p>
  <audio id="audio" controls></audio>
  <a id="download-btn" style="display:none">Download</a>
</div>

<script>
/* ---------------------------
   ðŸ”¹ AUDIO CODE (UNCHANGED)
---------------------------- */
const pad=n=>String(n).padStart(2,"0");
let lastSelectedBtn=null;
const langNames={"ta_my":"Tamil","en":"English"};

function attachAudio(btn,y,m,d){
  btn.onclick=function(){
    if(lastSelectedBtn) lastSelectedBtn.classList.remove("selected");
    btn.classList.add("selected");
    lastSelectedBtn=btn;

    const lang="ta_my";
    const url=`https://murli.madhuban.org/murlis/${lang}/mp3/murli-${y}-${pad(m+1)}-${pad(d)}.mp3`;

    document.getElementById("selected-date").textContent=
      `Playing: ${pad(d)}-${pad(m+1)}-${y} (${langNames[lang]})`;

    const audio=document.getElementById("audio");
    audio.src=url;
    audio.play();

    const dl=document.getElementById("download-btn");
    dl.href=url; dl.style.display="inline-block";
  };
}

/* ---------------------------
   ðŸ”¹ DYNAMIC CALENDAR LOGIC
---------------------------- */
const monthNames=[
"January","February","March","April","May","June",
"July","August","September","October","November","December"
];
const dayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];

fetch("calendar-years.json")
.then(r=>r.json())
.then(cfg=>{
  const today=new Date();
  const currentYear=today.getFullYear();
  const currentMonth=today.getMonth();

  const start=Math.max(cfg.startYear, currentYear-(cfg.windowSize-1));
  const end=Math.min(cfg.endYear, currentYear);

  const calendar=document.getElementById("calendar");

  for(let y=start;y<=end;y++){
    const yearBox=document.createElement("section");
    yearBox.className="year";
    yearBox.innerHTML=`<h2>${y}</h2>`;
    const months=document.createElement("div");
    months.className="months";

    for(let m=0;m<12;m++){
      if(y===currentYear && m>currentMonth) break;

      const month=document.createElement("div");
      month.className="month";
      month.innerHTML=`<h3>${monthNames[m]}</h3>`;
      const table=document.createElement("table");

      let tr="<tr>"+dayNames.map(d=>`<th>${d}</th>`).join("")+"</tr>";
      table.innerHTML=tr;

      const firstDay=new Date(y,m,1).getDay();
      const days=new Date(y,m+1,0).getDate();
      let day=1;

      for(let w=0;w<6;w++){
        const row=document.createElement("tr");
        for(let d=0;d<7;d++){
          const td=document.createElement("td");
          if((w===0&&d<firstDay)||day>days){
            td.innerHTML="";
          } else {
            const btn=document.createElement("button");
            btn.className="day-btn";
            btn.textContent=day;
            attachAudio(btn,y,m,day);
            td.appendChild(btn);
            day++;
          }
          row.appendChild(td);
        }
        table.appendChild(row);
        if(day>days) break;
      }

      month.appendChild(table);
      months.appendChild(month);
    }

    yearBox.appendChild(months);
    calendar.appendChild(yearBox);
  }
});
</script>

</body>
</html>
