<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Madhuban Murli Audio Library</title>

<style>
html { scroll-behavior: smooth; }
body {
  font-family: Arial, sans-serif;
  margin: 10px;
  background: #f5f5f5;
  color: #111;
}
h1 { text-align:center; }

#controls {
  text-align:center;
  margin-bottom:10px;
}

#year-links {
  text-align:center;
  margin:10px auto;
  padding:10px;
  background:#fff;
  border-radius:6px;
}

#year-links a {
  margin:0 8px;
  font-weight:bold;
  color:#2563eb;
  text-decoration:none;
}

.year {
  background:#fff;
  padding:10px;
  margin-bottom:20px;
  border-radius:6px;
}

.months {
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}

@media(max-width:900px){
  .months { grid-template-columns:1fr; }
}

.month {
  background:#fafafa;
  padding:8px;
  border-radius:6px;
}

.month h3 {
  text-align:center;
  font-size:15px;
}

table {
  width:100%;
  border-collapse:collapse;
  font-size:11px;
}

th,td {
  padding:3px;
  text-align:center;
}

button.day-btn {
  width:100%;
  padding:4px;
  border-radius:4px;
  border:1px solid #ccc;
  background:#e7f3ff;
  cursor:pointer;
}

button.day-btn.selected {
  background:#2563eb;
  color:#fff;
  font-weight:bold;
}

.jump-top {
  text-align:right;
  margin-top:5px;
}

.jump-top a {
  font-size:12px;
  font-weight:bold;
}
</style>
</head>

<body id="top">

<h1>Madhuban Murli Audio Library</h1>

<!-- CONTROLS -->
<div id="controls">
  <label><strong>Language:</strong></label>
  <select id="language">
    <option value="as" selected>‡¶Ö‡¶∏‡¶Æ‡ßÄ‡¶Ø‡¶º‡¶æ (Assamese)</option>
    <option value="en">English</option>
    <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
    <option value="ta_my">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Chennai)</option>
    <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Sri Lanka)</option>
    <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
    <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
    <option value="ml">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
    <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
    <option value="gu">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</option>
    <option value="pa">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä</option>
    <option value="si">‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω</option>
    <option value="ne">‡§®‡•á‡§™‡§æ‡§≤‡•Ä</option>
    <option value="or">‡¨ì‡¨°‡¨º‡¨ø‡¨Ü</option>
    <option value="fr">Fran√ßais</option>
    <option value="es">Espa√±ol</option>
    <option value="de">Deutsch</option>
    <option value="it">Italiano</option>
    <option value="pl">Polish</option>
    <option value="pt">Portugu√™s</option>
    <option value="ro">Rom√¢nƒÉ</option>
    <option value="el">Greek</option>
    <option value="th">Thai</option>
  </select>
</div>

<div id="year-links"></div>
<div id="calendar"></div>

<!-- PLAYER -->
<div id="player" style="text-align:center;margin:20px;">
  <p id="selected-date">Click a date to play Murli</p>
  <audio id="audio" controls></audio><br>
  <a id="download-btn" style="display:none;" download>Download MP3</a>
</div>

<script>
/* ===== DATE SOURCE (TEST or PRODUCTION) ===== */

// üëâ Use this ONLY for testing future behaviour
// üëâ Keep it empty "" for normal production
const TEST_DATE = "2026-01-01";  
// Examples for testing:
// "2026-01-01"
// "2026-02-01"
// "2027-01-01"

// Single source of truth for "today"
const today = TEST_DATE ? new Date(TEST_DATE) : new Date();
  
/* ================= CONFIG ================= */
const WINDOW_YEARS = 7;

const calendarFiles = [
  "data/calendar-2019.json",
  "data/calendar-2020.json",
  "data/calendar-2021.json",
  "data/calendar-2022.json",
  "data/calendar-2023.json",
  "data/calendar-2024.json",
  "data/calendar-2025.json",
  "data/calendar-2026.json",
  "data/calendar-2027.json"
];

const monthNames = [
  "January","February","March","April","May","June",
  "July","August","September","October","November","December"
];

const dayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
const pad=n=>String(n).padStart(2,"0");

let lastSelectedBtn=null;

/* ================= DATE LOGIC ================= */
//const today = new Date();
const currentYear = today.getFullYear();
const currentMonth = today.getMonth();

function shouldRenderYear(year){
  const earliestYear = currentYear - (WINDOW_YEARS - 1);
  return year >= earliestYear && year <= currentYear;
}

function monthsToRender(year){
  if (year < currentYear) return 12;
  return currentMonth + 1;
}

/* ================= CALENDAR ================= */
async function loadCalendars(){
  const container=document.getElementById("calendar");
  const yearLinks=document.getElementById("year-links");

  for(const file of calendarFiles){
    const res = await fetch(file);
    const data = await res.json();
    const year = data.year;

    if(!shouldRenderYear(year)) continue;

    // year link
    const link=document.createElement("a");
    link.href="#y"+year;
    link.textContent=year;
    yearLinks.appendChild(link);

    const yearBox=document.createElement("section");
    yearBox.className="year";
    yearBox.id="y"+year;
    yearBox.innerHTML=`<h2>${year}</h2>`;

    const months=document.createElement("div");
    months.className="months";

    const maxMonths = monthsToRender(year);

    for(let m=0;m<maxMonths;m++){
      const monthDiv=document.createElement("div");
      monthDiv.className="month";
      monthDiv.innerHTML=`<h3>${monthNames[m]}</h3>`;

      const table=document.createElement("table");
      table.innerHTML="<thead><tr>"+dayNames.map(d=>`<th>${d}</th>`).join("")+"</tr></thead>";
      const tbody=document.createElement("tbody");

      const firstDay=new Date(year,m,1).getDay();
      const daysInMonth=new Date(year,m+1,0).getDate();

      let day=1;
      for(let w=0;w<6;w++){
        const tr=document.createElement("tr");
        for(let d=0;d<7;d++){
          const td=document.createElement("td");
          if((w===0 && d<firstDay) || day>daysInMonth){
            td.innerHTML="";
          } else {
            const btn=document.createElement("button");
            btn.className="day-btn";
            btn.textContent=day;

            btn.onclick=()=>{
              if(lastSelectedBtn) lastSelectedBtn.classList.remove("selected");
              btn.classList.add("selected");
              lastSelectedBtn=btn;

              const lang=document.getElementById("language").value;
              const url=`https://murli.madhuban.org/murlis/${lang}/mp3/murli-${year}-${pad(m+1)}-${pad(day)}.mp3`;

              const audio=document.getElementById("audio");
              audio.src=url;
              audio.play();

              audio.onerror=()=>{
                document.getElementById("selected-date").textContent=
                  "Murli audio not available for this date.";
              };

              document.getElementById("download-btn").href=url;
              document.getElementById("download-btn").style.display="inline";
              document.getElementById("selected-date").textContent=
                `Playing: ${pad(day)}-${pad(m+1)}-${year}`;
            };

            td.appendChild(btn);
            day++;
          }
          tr.appendChild(td);
        }
        tbody.appendChild(tr);
        if(day>daysInMonth) break;
      }

      table.appendChild(tbody);
      monthDiv.appendChild(table);

      if(year === currentYear && m === maxMonths - 1){
        monthDiv.innerHTML += `<div class="jump-top"><a href="#top">‚¨Ü Go Top</a></div>`;
      }

      months.appendChild(monthDiv);
    }

    yearBox.appendChild(months);
    container.appendChild(yearBox);
  }
}

/* ================= LANGUAGE CHANGE ================= */
document.getElementById("language").addEventListener("change",()=>{
  if(lastSelectedBtn) lastSelectedBtn.click();
});

loadCalendars();
</script>

</body>
</html>
